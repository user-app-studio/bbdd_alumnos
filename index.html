<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>JAM — Gestión de Alumnos</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300..700;1,9..40,300..700&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }
:root {
  --brand: #2E8BC0;
  --brand-dark: #1B6A9C;
  --brand-light: #E8F4FA;
  --brand-pale: #F4FAFD;
  --text: #1a2a3a;
  --text-secondary: #5a6a7a;
  --surface: #ffffff;
  --bg: #f0f4f8;
  --border: #dce4ec;
  --danger: #d94452;
  --danger-light: #fdf0f1;
  --success: #2a9d6a;
  --success-light: #edf9f3;
  --warning: #e8a820;
  --warning-light: #fef9ee;
  --radius: 12px;
  --radius-sm: 8px;
  --shadow: 0 1px 3px rgba(0,0,0,.06), 0 4px 12px rgba(0,0,0,.04);
  --shadow-lg: 0 4px 24px rgba(0,0,0,.08);
  --transition: .2s ease;
  --sidebar-w: 260px;
}
html { font-size: 15px; }
body {
  font-family: 'DM Sans', sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  display: flex;
  overflow-x: hidden;
}
/* ── Sidebar ── */
.sidebar {
  width: var(--sidebar-w);
  min-height: 100vh;
  background: linear-gradient(180deg, #1a3a52 0%, #1B3A50 100%);
  color: #fff;
  display: flex;
  flex-direction: column;
  position: fixed;
  left: 0; top: 0; bottom: 0;
  z-index: 100;
  transition: transform .3s ease;
}
.sidebar-brand {
  padding: 28px 24px 20px;
  display: flex;
  align-items: center;
  gap: 14px;
  border-bottom: 1px solid rgba(255,255,255,.08);
}
.sidebar-brand img { width: 48px; height: 48px; border-radius: 50%; border: 2px solid rgba(255,255,255,.2); }
.sidebar-brand .brand-text { display: flex; flex-direction: column; }
.sidebar-brand .brand-name { font-weight: 700; font-size: 1.5rem; letter-spacing: .02em; line-height: 1; }
.sidebar-brand .brand-sub { font-size: .7rem; opacity: .5; text-transform: uppercase; letter-spacing: .12em; margin-top: 4px; }
.sidebar-nav { padding: 16px 12px; flex: 1; display: flex; flex-direction: column; gap: 2px; }
.nav-item {
  display: flex; align-items: center; gap: 12px;
  padding: 12px 16px;
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: all var(--transition);
  font-size: .88rem; font-weight: 500;
  color: rgba(255,255,255,.6);
  border: none; background: none; width: 100%; text-align: left;
}
.nav-item:hover { background: rgba(255,255,255,.06); color: rgba(255,255,255,.85); }
.nav-item.active { background: rgba(46,139,192,.25); color: #fff; box-shadow: inset 3px 0 0 var(--brand); }
.nav-item svg { width: 20px; height: 20px; flex-shrink: 0; }
.nav-divider { height: 1px; background: rgba(255,255,255,.06); margin: 12px 16px; }

/* Sync status indicator */
.sync-status {
  display: flex; align-items: center; gap: 8px;
  padding: 10px 16px;
  border-radius: var(--radius-sm);
  font-size: .78rem;
  color: rgba(255,255,255,.5);
  margin: 0 12px;
}
.sync-dot {
  width: 8px; height: 8px; border-radius: 50%;
  background: rgba(255,255,255,.2);
  flex-shrink: 0;
  transition: background .3s ease;
}
.sync-dot.syncing { background: var(--warning); animation: pulse 1s infinite; }
.sync-dot.synced { background: var(--success); }
.sync-dot.error { background: var(--danger); }
.sync-dot.offline { background: rgba(255,255,255,.25); }
@keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.4} }

.sidebar-footer { padding: 16px 20px; border-top: 1px solid rgba(255,255,255,.06); font-size: .72rem; color: rgba(255,255,255,.3); text-align: center; }
/* ── Main ── */
.main { margin-left: var(--sidebar-w); flex: 1; min-height: 100vh; display: flex; flex-direction: column; }
.topbar { background: var(--surface); border-bottom: 1px solid var(--border); padding: 16px 32px; display: flex; align-items: center; justify-content: space-between; gap: 16px; position: sticky; top: 0; z-index: 50; }
.topbar-title { font-weight: 700; font-size: 1.45rem; color: var(--text); }
.topbar-actions { display: flex; gap: 8px; align-items: center; }
.content { padding: 28px 32px; flex: 1; }
/* ── Buttons ── */
.btn { display: inline-flex; align-items: center; gap: 7px; padding: 9px 18px; border-radius: var(--radius-sm); font-family: inherit; font-size: .82rem; font-weight: 600; cursor: pointer; border: 1.5px solid transparent; transition: all var(--transition); white-space: nowrap; }
.btn svg { width: 16px; height: 16px; }
.btn-primary { background: var(--brand); color: #fff; border-color: var(--brand); }
.btn-primary:hover { background: var(--brand-dark); border-color: var(--brand-dark); transform: translateY(-1px); box-shadow: 0 4px 12px rgba(46,139,192,.3); }
.btn-secondary { background: var(--surface); color: var(--text); border-color: var(--border); }
.btn-secondary:hover { border-color: var(--brand); color: var(--brand); }
.btn-danger { background: var(--danger); color: #fff; border-color: var(--danger); }
.btn-danger:hover { background: #c03040; }
.btn-ghost { background: none; color: var(--text-secondary); border: none; padding: 8px 12px; }
.btn-ghost:hover { color: var(--brand); background: var(--brand-light); }
.btn-sm { padding: 6px 12px; font-size: .78rem; }
/* ── Search ── */
.search-box { position: relative; max-width: 360px; flex: 1; }
.search-box input { width: 100%; padding: 9px 14px 9px 38px; border: 1.5px solid var(--border); border-radius: var(--radius-sm); font-family: inherit; font-size: .85rem; background: var(--bg); transition: all var(--transition); color: var(--text); }
.search-box input:focus { outline: none; border-color: var(--brand); background: #fff; box-shadow: 0 0 0 3px rgba(46,139,192,.1); }
.search-box svg { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); width: 16px; height: 16px; color: var(--text-secondary); }
/* ── Cards ── */
.card { background: var(--surface); border-radius: var(--radius); border: 1px solid var(--border); box-shadow: var(--shadow); }
.card-header { padding: 18px 22px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; }
.card-header h3 { font-size: .95rem; font-weight: 600; }
.card-body { padding: 22px; }
/* ── Student Table ── */
.students-table { width: 100%; border-collapse: collapse; }
.students-table th { text-align: left; padding: 10px 14px; font-size: .72rem; font-weight: 700; text-transform: uppercase; letter-spacing: .08em; color: var(--text-secondary); border-bottom: 2px solid var(--border); }
.students-table td { padding: 12px 14px; font-size: .85rem; border-bottom: 1px solid #f0f2f5; vertical-align: middle; }
.students-table tr:hover td { background: var(--brand-pale); }
.students-table .student-name { font-weight: 600; color: var(--text); }
.students-table .student-email { color: var(--text-secondary); font-size: .78rem; }
/* ── Badges ── */
.badge { display: inline-block; padding: 3px 10px; border-radius: 20px; font-size: .7rem; font-weight: 600; }
.badge-success { background: var(--success-light); color: var(--success); }
.badge-danger { background: var(--danger-light); color: var(--danger); }
.badge-warning { background: var(--warning-light); color: var(--warning); }
.badge-info { background: var(--brand-light); color: var(--brand); }
/* ── Form ── */
.form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 18px; }
.form-group { display: flex; flex-direction: column; gap: 6px; }
.form-group.full { grid-column: 1 / -1; }
.form-label { font-size: .78rem; font-weight: 600; color: var(--text-secondary); }
.form-control { padding: 10px 14px; border: 1.5px solid var(--border); border-radius: var(--radius-sm); font-family: inherit; font-size: .85rem; transition: all var(--transition); background: #fff; color: var(--text); }
.form-control:focus { outline: none; border-color: var(--brand); box-shadow: 0 0 0 3px rgba(46,139,192,.08); }
textarea.form-control { resize: vertical; min-height: 70px; }
select.form-control { cursor: pointer; }
/* ── History Table ── */
.history-table { width: 100%; border-collapse: collapse; margin-top: 8px; }
.history-table th { text-align: left; padding: 8px 12px; font-size: .72rem; font-weight: 700; text-transform: uppercase; letter-spacing: .06em; color: var(--text-secondary); background: var(--bg); border-bottom: 2px solid var(--border); }
.history-table td { padding: 8px 12px; font-size: .82rem; border-bottom: 1px solid #f0f2f5; }
.history-table tr:hover td { background: var(--brand-pale); }
.form-actions { display: flex; gap: 10px; justify-content: flex-end; padding-top: 20px; border-top: 1px solid var(--border); margin-top: 10px; }
/* ── Modal ── */
.modal-overlay { position: fixed; inset: 0; background: rgba(15,25,35,.45); backdrop-filter: blur(4px); z-index: 200; display: flex; align-items: flex-start; justify-content: center; padding: 40px 20px; overflow-y: auto; opacity: 0; pointer-events: none; transition: opacity .25s ease; }
.modal-overlay.active { opacity: 1; pointer-events: all; }
.modal { background: var(--surface); border-radius: var(--radius); width: 100%; max-width: 720px; box-shadow: var(--shadow-lg); transform: translateY(20px); transition: transform .3s ease; }
.modal-overlay.active .modal { transform: translateY(0); }
.modal-header { display: flex; align-items: center; justify-content: space-between; padding: 20px 24px; border-bottom: 1px solid var(--border); }
.modal-header h2 { font-weight: 700; font-size: 1.3rem; }
.modal-body { padding: 24px; max-height: 70vh; overflow-y: auto; }
.modal-close { width: 32px; height: 32px; border: none; background: var(--bg); border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all var(--transition); color: var(--text-secondary); }
.modal-close:hover { background: var(--danger-light); color: var(--danger); }
/* ── Confirm Dialog ── */
.confirm-dialog { max-width: 400px; text-align: center; }
.confirm-dialog .modal-body { padding: 32px 24px; }
.confirm-icon { width: 56px; height: 56px; border-radius: 50%; background: var(--danger-light); color: var(--danger); display: flex; align-items: center; justify-content: center; margin: 0 auto 16px; }
.confirm-icon svg { width: 28px; height: 28px; }
.confirm-title { font-size: 1.05rem; font-weight: 700; margin-bottom: 8px; }
.confirm-text { font-size: .85rem; color: var(--text-secondary); margin-bottom: 24px; line-height: 1.5; }
.confirm-actions { display: flex; gap: 10px; justify-content: center; }
/* ── Stats ── */
.stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 16px; margin-bottom: 24px; }
.stat-card { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); padding: 20px; box-shadow: var(--shadow); }
.stat-label { font-size: .72rem; font-weight: 600; text-transform: uppercase; letter-spacing: .08em; color: var(--text-secondary); margin-bottom: 8px; }
.stat-value { font-weight: 700; font-size: 2rem; color: var(--text); line-height: 1; }
.stat-sub { font-size: .75rem; color: var(--text-secondary); margin-top: 4px; }
.charts-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
.chart-card { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); padding: 20px; box-shadow: var(--shadow); }
.chart-card h4 { font-size: .82rem; font-weight: 700; color: var(--text); margin-bottom: 16px; }
.chart-container { position: relative; height: 260px; }
.topic-list { list-style: none; display: flex; flex-direction: column; gap: 6px; }
.topic-item { display: flex; align-items: center; justify-content: space-between; padding: 8px 12px; background: var(--bg); border-radius: var(--radius-sm); font-size: .82rem; }
.topic-count { background: var(--brand-light); color: var(--brand-dark); padding: 2px 10px; border-radius: 20px; font-size: .72rem; font-weight: 700; }
/* ── Profile ── */
.profile-header { display: flex; align-items: center; gap: 20px; margin-bottom: 24px; padding-bottom: 20px; border-bottom: 1px solid var(--border); }
.profile-avatar { width: 64px; height: 64px; border-radius: 50%; background: var(--brand); color: #fff; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 1.5rem; flex-shrink: 0; }
.profile-info h2 { font-weight: 700; font-size: 1.4rem; margin-bottom: 4px; }
.profile-meta { display: flex; gap: 16px; flex-wrap: wrap; font-size: .8rem; color: var(--text-secondary); }
.profile-meta span { display: flex; align-items: center; gap: 4px; }
.profile-section { margin-bottom: 20px; }
.profile-section h4 { font-size: .78rem; font-weight: 700; text-transform: uppercase; letter-spacing: .08em; color: var(--text-secondary); margin-bottom: 10px; padding-bottom: 6px; border-bottom: 1px solid var(--border); }
.profile-section p { font-size: .88rem; line-height: 1.6; white-space: pre-wrap; }
.profile-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
/* ── Empty State ── */
.empty-state { text-align: center; padding: 60px 20px; }
.empty-state svg { width: 64px; height: 64px; color: var(--border); margin-bottom: 16px; }
.empty-state h3 { font-size: 1.1rem; margin-bottom: 8px; color: var(--text); }
.empty-state p { font-size: .85rem; color: var(--text-secondary); margin-bottom: 20px; }
/* ── Mobile ── */
.hamburger { display: none; background: none; border: none; cursor: pointer; padding: 8px; color: var(--text); }
.hamburger svg { width: 24px; height: 24px; }
.sidebar-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,.4); z-index: 99; }
/* ── Views ── */
.view { display: none; }
.view.active { display: block; }
/* ── Print ── */
@media print {
  .sidebar, .topbar, .btn, .modal-overlay, .hamburger, .sidebar-overlay { display: none !important; }
  .main { margin-left: 0 !important; }
  .content { padding: 0 !important; }
  .card { box-shadow: none; border: 1px solid #ddd; }
  .print-header { display: flex !important; align-items: center; gap: 16px; margin-bottom: 24px; padding-bottom: 16px; border-bottom: 2px solid var(--brand); }
  .print-header img { width: 48px; height: 48px; }
  .print-header h1 { font-weight: 700; font-size: 1.4rem; }
}
.print-header { display: none; }
/* ── Responsive ── */
@media (max-width: 900px) {
  .sidebar { transform: translateX(-100%); }
  .sidebar.open { transform: translateX(0); }
  .sidebar-overlay.open { display: block; }
  .hamburger { display: block; }
  .main { margin-left: 0; }
  .topbar { padding: 12px 16px; }
  .content { padding: 16px; }
  .form-grid { grid-template-columns: 1fr; }
  .charts-grid { grid-template-columns: 1fr; }
  .profile-grid { grid-template-columns: 1fr; }
  .stats-grid { grid-template-columns: 1fr 1fr; }
}
@media (max-width: 500px) { .stats-grid { grid-template-columns: 1fr; } }
/* ── Animations ── */
@keyframes fadeUp { from { opacity:0; transform:translateY(12px); } to { opacity:1; transform:translateY(0); } }
.fade-up { animation: fadeUp .4s ease both; }
.notification {
  position: fixed; bottom: 24px; right: 24px;
  background: var(--text); color: #fff;
  padding: 12px 20px; border-radius: var(--radius-sm);
  font-size: .84rem; font-weight: 500;
  box-shadow: var(--shadow-lg); z-index: 300;
  transform: translateY(80px); opacity: 0;
  transition: all .3s ease;
  max-width: 320px;
}
.notification.show { transform: translateY(0); opacity: 1; }
.notification.success { background: var(--success); }
.notification.error { background: var(--danger); }
.notification.warning { background: #b37a00; }
</style>
</head>
<body>

<div class="sidebar-overlay" id="sidebarOverlay"></div>

<aside class="sidebar" id="sidebar">
  <div class="sidebar-brand">
    <img id="logoImg" src="" alt="JAM Logo">
    <div class="brand-text">
      <span class="brand-name">JAM</span>
      <span class="brand-sub">Gestión de Alumnos</span>
    </div>
  </div>
  <nav class="sidebar-nav">
    <button class="nav-item active" data-view="students" onclick="switchView('students')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
      Alumnos
    </button>
    <button class="nav-item" data-view="add" onclick="switchView('add')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="8.5" cy="7" r="4"/><line x1="20" y1="8" x2="20" y2="14"/><line x1="23" y1="11" x2="17" y2="11"/></svg>
      Nuevo Alumno
    </button>
    <button class="nav-item" data-view="stats" onclick="switchView('stats')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>
      Estadísticas
    </button>
    <div class="nav-divider"></div>
    <button class="nav-item" onclick="exportToExcel()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><line x1="3" y1="9" x2="21" y2="9"/><line x1="3" y1="15" x2="21" y2="15"/><line x1="9" y1="3" x2="9" y2="21"/><line x1="15" y1="3" x2="15" y2="21"/></svg>
      Exportar Excel (backup)
    </button>
    <button class="nav-item" onclick="manualSync()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>
      Sincronizar ahora
    </button>
    <div class="nav-divider"></div>
    <button class="nav-item" onclick="showGitHubConfig()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/></svg>
      Configurar GitHub
    </button>
  </nav>

  <!-- Sync Status -->
  <div class="sync-status" id="syncStatus">
    <div class="sync-dot offline" id="syncDot"></div>
    <span id="syncText">Sin configurar</span>
  </div>

  <div class="sidebar-footer">JLMF12 & JAM STUDIO &copy; 2026</div>
</aside>

<div class="main">
  <header class="topbar">
    <div style="display:flex;align-items:center;gap:12px;">
      <button class="hamburger" onclick="toggleSidebar()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
      </button>
      <h1 class="topbar-title" id="viewTitle">Alumnos</h1>
    </div>
    <div class="topbar-actions" id="topbarActions">
      <div class="search-box">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
        <input type="text" id="searchInput" placeholder="Buscar alumnos..." oninput="renderStudents()">
      </div>
      <button class="btn btn-primary" onclick="switchView('add')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
        Añadir
      </button>
    </div>
  </header>

  <div class="content">
    <div class="view active" id="view-students">
      <div class="card"><div id="studentsTableWrapper"></div></div>
    </div>

    <div class="view" id="view-add">
      <div class="card">
        <div class="card-header"><h3 id="formTitle">Nuevo Alumno</h3></div>
        <div class="card-body">
          <form id="studentForm" onsubmit="saveStudent(event)">
            <input type="hidden" id="editId">
            <div class="form-grid">
              <div class="form-group">
                <label class="form-label">Nombre completo *</label>
                <input type="text" class="form-control" id="f_nombre" required>
              </div>
              <div class="form-group">
                <label class="form-label">Teléfono</label>
                <input type="tel" class="form-control" id="f_telefono">
              </div>
              <div class="form-group">
                <label class="form-label">Correo electrónico</label>
                <input type="email" class="form-control" id="f_correo">
              </div>
              <div class="form-group">
                <label class="form-label">Dirección</label>
                <input type="text" class="form-control" id="f_direccion">
              </div>
              <div class="form-group">
                <label class="form-label">Sexo</label>
                <select class="form-control" id="f_sexo">
                  <option value="">— Seleccionar —</option>
                  <option value="Masculino">Masculino</option>
                  <option value="Femenino">Femenino</option>
                  <option value="Otro">Otro</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Edad</label>
                <input type="number" class="form-control" id="f_edad" min="1" max="120">
              </div>
              <div class="form-group">
                <label class="form-label">Fecha última clase</label>
                <input type="date" class="form-control" id="f_fechaUltimaClase">
              </div>
              <div class="form-group">
                <label class="form-label">Duración última clase</label>
                <select class="form-control" id="f_duracion">
                  <option value="">— Seleccionar —</option>
                  <option value="30min">30 minutos</option>
                  <option value="45min">45 minutos</option>
                  <option value="1h">1 hora</option>
                  <option value="1.5h">1 hora y media</option>
                  <option value="2h">2 horas</option>
                  <option value="2.5h">2 horas y media</option>
                  <option value="3h">3 horas</option>
                  <option value="3.5h">3 horas y media</option>
                  <option value="4h">4 horas</option>
                  <option value="4.5h">4 horas y media</option>
                  <option value="5h">5 horas</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">¿Paga bien?</label>
                <select class="form-control" id="f_pago">
                  <option value="">— Seleccionar —</option>
                  <option value="Sí">Sí</option>
                  <option value="No">No</option>
                  <option value="A veces">A veces</option>
                  <option value="Se lo hago gratis">Se lo hago gratis</option>
                </select>
              </div>
              <div class="form-group full">
                <label class="form-label">Temática tratada</label>
                <textarea class="form-control" id="f_tematica" rows="2" placeholder="Ej: Word, Excel, navegación web, correo electrónico..."></textarea>
              </div>
              <div class="form-group">
                <label class="form-label">Lo que sabe hacer</label>
                <textarea class="form-control" id="f_sabe" rows="3" placeholder="Habilidades que ya domina..."></textarea>
              </div>
              <div class="form-group">
                <label class="form-label">Lo que no sabe hacer</label>
                <textarea class="form-control" id="f_nosabe" rows="3" placeholder="Áreas donde necesita mejorar..."></textarea>
              </div>
              <div class="form-group full">
                <label class="form-label">Necesidades especiales</label>
                <textarea class="form-control" id="f_necesidades" rows="2" placeholder="Necesidades particulares del alumno..."></textarea>
              </div>
              <div class="form-group full">
                <label class="form-label">Personalidad del alumno</label>
                <textarea class="form-control" id="f_personalidad" rows="2" placeholder="Amigable, reservado, paciente, nervioso..."></textarea>
              </div>
              <div class="form-group full">
                <label class="form-label">Sugerencias para ayudarle mejor</label>
                <textarea class="form-control" id="f_sugerencias" rows="2" placeholder="Medidas recomendadas, enfoques pedagógicos..."></textarea>
              </div>
              <div class="form-group">
                <label class="form-label">¿Recomendable seguir con él?</label>
                <select class="form-control" id="f_aconsejable">
                  <option value="">— Seleccionar —</option>
                  <option value="Sí">Sí</option>
                  <option value="No">No</option>
                  <option value="En evaluación">En evaluación</option>
                </select>
              </div>
              <div class="form-group">&nbsp;</div>
              <div class="form-group full">
                <label class="form-label">Notas adicionales</label>
                <textarea class="form-control" id="f_notas" rows="3" placeholder="Cualquier información relevante adicional..."></textarea>
              </div>
            </div>
            <div class="form-actions">
              <button type="button" class="btn btn-secondary" onclick="cancelForm()">Cancelar</button>
              <button type="submit" class="btn btn-primary" id="formSubmitBtn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                Guardar Alumno
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <div class="view" id="view-profile">
      <div class="print-header" id="printHeader">
        <img id="printLogo" src="" alt="JAM">
        <div><h1>JAM Informática — Ficha de Alumno</h1></div>
      </div>
      <div id="profileContent"></div>
    </div>

    <div class="view" id="view-stats">
      <div id="statsContent"></div>
    </div>
  </div>
</div>

<!-- GitHub Config Modal -->
<div class="modal-overlay" id="githubOverlay">
  <div class="modal" style="max-width:520px;">
    <div class="modal-header">
      <h2>Configurar GitHub</h2>
      <button class="modal-close" onclick="closeGitHub()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
      </button>
    </div>
    <div class="modal-body">
      <div style="background:var(--brand-light);border-radius:var(--radius-sm);padding:12px 16px;margin-bottom:18px;font-size:.82rem;color:var(--brand-dark);line-height:1.5;">
        <strong>Auto-sincronización activa:</strong> Al guardar la configuración, los datos se cargarán automáticamente desde GitHub al abrir la app, y se guardarán en GitHub al añadir, editar o eliminar alumnos.
      </div>
      <div style="display:flex;flex-direction:column;gap:14px;">
        <div class="form-group">
          <label class="form-label">Token de acceso personal (PAT)</label>
          <input type="password" class="form-control" id="gh_token" placeholder="ghp_xxxxxxxxxxxx">
          <span style="font-size:.7rem;color:var(--text-secondary);">GitHub → Settings → Developer settings → Personal access tokens. Necesita permisos de "repo".</span>
        </div>
        <div class="form-group">
          <label class="form-label">Repositorio (usuario/repo)</label>
          <input type="text" class="form-control" id="gh_repo" placeholder="usuario/mi-base-datos">
        </div>
        <div class="form-group">
          <label class="form-label">Nombre del archivo JSON de datos</label>
          <input type="text" class="form-control" id="gh_filename" value="jam_alumnos.json">
          <span style="font-size:.7rem;color:var(--text-secondary);">Se usará JSON para sincronización (más eficiente). El Excel es solo para backup local.</span>
        </div>
        <div class="form-group">
          <label class="form-label">Rama</label>
          <input type="text" class="form-control" id="gh_branch" value="main">
        </div>
        <div class="form-actions" style="border-top:none;margin-top:0;padding-top:0;">
          <button class="btn btn-secondary" onclick="closeGitHub()">Cancelar</button>
          <button class="btn btn-primary" onclick="saveGitHubConfig()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><polyline points="20 6 9 17 4 12"/></svg>
            Guardar y conectar
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Confirm Modal -->
<div class="modal-overlay" id="confirmOverlay">
  <div class="modal confirm-dialog">
    <div class="modal-body">
      <div class="confirm-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>
      </div>
      <div class="confirm-title" id="confirmTitle">¿Eliminar alumno?</div>
      <div class="confirm-text" id="confirmText">Esta acción no se puede deshacer.</div>
      <div class="confirm-actions">
        <button class="btn btn-secondary" onclick="closeConfirm()">Cancelar</button>
        <button class="btn btn-danger" id="confirmBtn">Eliminar</button>
      </div>
    </div>
  </div>
</div>

<div class="notification" id="notification"></div>

<script>
// ═══════════════════════════════════════════
// DATABASE
// ═══════════════════════════════════════════
const STORAGE_KEY = 'jam_students_db';
let db = [];
let chartInstances = {};

function loadDB() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    db = raw ? JSON.parse(raw) : [];
  } catch(e) { db = []; }
}
function saveDB() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(db));
}
function generateId() {
  return Date.now().toString(36) + Math.random().toString(36).substr(2, 6);
}

// ═══════════════════════════════════════════
// GITHUB CONFIG
// ═══════════════════════════════════════════
const GH_CONFIG_KEY = 'jam_github_config';

function loadGitHubConfig() {
  try { return JSON.parse(localStorage.getItem(GH_CONFIG_KEY)) || {}; }
  catch(e) { return {}; }
}

function isGitHubConfigured() {
  const cfg = loadGitHubConfig();
  return !!(cfg.token && cfg.repo);
}

function showGitHubConfig() {
  const cfg = loadGitHubConfig();
  document.getElementById('gh_token').value = cfg.token || '';
  document.getElementById('gh_repo').value = cfg.repo || '';
  document.getElementById('gh_filename').value = cfg.filename || 'jam_alumnos.json';
  document.getElementById('gh_branch').value = cfg.branch || 'main';
  document.getElementById('githubOverlay').classList.add('active');
  closeSidebar();
}
function closeGitHub() {
  document.getElementById('githubOverlay').classList.remove('active');
}
async function saveGitHubConfig() {
  const cfg = {
    token: document.getElementById('gh_token').value.trim(),
    repo: document.getElementById('gh_repo').value.trim(),
    filename: document.getElementById('gh_filename').value.trim() || 'jam_alumnos.json',
    branch: document.getElementById('gh_branch').value.trim() || 'main'
  };
  if (!cfg.token || !cfg.repo) { notify('Token y repositorio son obligatorios', 'error'); return; }
  localStorage.setItem(GH_CONFIG_KEY, JSON.stringify(cfg));
  closeGitHub();
  notify('Configuración guardada. Cargando datos de GitHub...', 'warning');
  await pullFromGitHub(true);
}

// ═══════════════════════════════════════════
// SYNC STATUS UI
// ═══════════════════════════════════════════
function setSyncStatus(state, text) {
  const dot = document.getElementById('syncDot');
  const txt = document.getElementById('syncText');
  dot.className = 'sync-dot ' + state;
  txt.textContent = text;
}

// ═══════════════════════════════════════════
// GITHUB PUSH (guardar en GitHub)
// ═══════════════════════════════════════════
async function pushToGitHub() {
  const cfg = loadGitHubConfig();
  if (!cfg.token || !cfg.repo) return; // silencioso si no configurado

  setSyncStatus('syncing', 'Guardando...');
  try {
    const content = btoa(unescape(encodeURIComponent(JSON.stringify(db, null, 2))));
    const apiBase = `https://api.github.com/repos/${cfg.repo}/contents/${cfg.filename}`;

    // Obtener SHA del archivo si existe
    let sha = null;
    try {
      const existing = await fetch(`${apiBase}?ref=${cfg.branch}`, {
        headers: { 'Authorization': `token ${cfg.token}`, 'Accept': 'application/vnd.github.v3+json' }
      });
      if (existing.ok) { const data = await existing.json(); sha = data.sha; }
    } catch(e) {}

    const body = {
      message: `Actualizar alumnos - ${new Date().toLocaleString('es-ES')}`,
      content,
      branch: cfg.branch
    };
    if (sha) body.sha = sha;

    const response = await fetch(apiBase, {
      method: 'PUT',
      headers: {
        'Authorization': `token ${cfg.token}`,
        'Accept': 'application/vnd.github.v3+json',
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(body)
    });

    if (response.ok) {
      const now = new Date().toLocaleTimeString('es-ES', {hour:'2-digit', minute:'2-digit'});
      setSyncStatus('synced', 'Sync ' + now);
    } else {
      const err = await response.json();
      setSyncStatus('error', 'Error al guardar');
      notify('Error GitHub: ' + (err.message || 'No se pudo guardar'), 'error');
    }
  } catch(e) {
    setSyncStatus('error', 'Sin conexión');
    notify('Sin conexión con GitHub', 'error');
  }
}

// ═══════════════════════════════════════════
// GITHUB PULL (cargar desde GitHub)
// ═══════════════════════════════════════════
async function pullFromGitHub(silent = false) {
  const cfg = loadGitHubConfig();
  if (!cfg.token || !cfg.repo) {
    setSyncStatus('offline', 'Sin configurar');
    return;
  }

  setSyncStatus('syncing', 'Cargando...');
  try {
    const apiBase = `https://api.github.com/repos/${cfg.repo}/contents/${cfg.filename}`;
    const response = await fetch(`${apiBase}?ref=${cfg.branch}&t=${Date.now()}`, {
      headers: { 'Authorization': `token ${cfg.token}`, 'Accept': 'application/vnd.github.v3+json' }
    });

    if (response.status === 404) {
      // Archivo no existe aún en GitHub → subir los datos locales
      setSyncStatus('synced', 'Listo (nuevo)');
      if (!silent) notify('Archivo nuevo en GitHub. Se subirán los datos locales.', 'warning');
      await pushToGitHub();
      return;
    }

    if (!response.ok) {
      const err = await response.json();
      setSyncStatus('error', 'Error al cargar');
      if (!silent) notify('Error GitHub: ' + (err.message || 'No se pudo cargar'), 'error');
      return;
    }

    const fileData = await response.json();
    const decoded = decodeURIComponent(escape(atob(fileData.content.replace(/\n/g, ''))));
    const imported = JSON.parse(decoded);

    if (!Array.isArray(imported)) throw new Error('Formato inválido');

    db = imported;
    saveDB();
    renderStudents();

    const now = new Date().toLocaleTimeString('es-ES', {hour:'2-digit', minute:'2-digit'});
    setSyncStatus('synced', 'Sync ' + now);
    if (!silent) notify(`${db.length} alumnos cargados desde GitHub`, 'success');

  } catch(e) {
    setSyncStatus('error', 'Error de sync');
    if (!silent) notify('Error al cargar desde GitHub', 'error');
    console.error(e);
  }
}

// Sincronización manual (botón)
async function manualSync() {
  closeSidebar();
  notify('Sincronizando con GitHub...', 'warning');
  await pullFromGitHub(false);
}

// ═══════════════════════════════════════════
// NAVIGATION
// ═══════════════════════════════════════════
const viewTitles = { students: 'Alumnos', add: 'Nuevo Alumno', stats: 'Estadísticas', profile: 'Ficha del Alumno' };

function switchView(name) {
  document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
  document.getElementById('view-' + name).classList.add('active');
  document.querySelectorAll('.nav-item[data-view]').forEach(n => n.classList.remove('active'));
  const navBtn = document.querySelector(`.nav-item[data-view="${name}"]`);
  if (navBtn) navBtn.classList.add('active');
  document.getElementById('viewTitle').textContent = viewTitles[name] || '';
  const ta = document.getElementById('topbarActions');
  ta.style.display = name === 'students' ? 'flex' : 'none';
  if (name === 'students') renderStudents();
  if (name === 'stats') renderStats();
  if (name === 'add' && !document.getElementById('editId').value) {
    document.getElementById('formTitle').textContent = 'Nuevo Alumno';
    document.getElementById('formSubmitBtn').innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg> Guardar Alumno';
  }
  closeSidebar();
}

function toggleSidebar() {
  document.getElementById('sidebar').classList.toggle('open');
  document.getElementById('sidebarOverlay').classList.toggle('open');
}
function closeSidebar() {
  document.getElementById('sidebar').classList.remove('open');
  document.getElementById('sidebarOverlay').classList.remove('open');
}
document.getElementById('sidebarOverlay').addEventListener('click', closeSidebar);

// ═══════════════════════════════════════════
// NOTIFICATIONS
// ═══════════════════════════════════════════
function notify(msg, type = '') {
  const el = document.getElementById('notification');
  el.textContent = msg;
  el.className = 'notification' + (type ? ' ' + type : '');
  el.classList.add('show');
  setTimeout(() => el.classList.remove('show'), 3000);
}

// ═══════════════════════════════════════════
// CONFIRM DIALOG
// ═══════════════════════════════════════════
function showConfirm(title, text, onConfirm, btnText = 'Eliminar') {
  document.getElementById('confirmTitle').textContent = title;
  document.getElementById('confirmText').textContent = text;
  const btn = document.getElementById('confirmBtn');
  btn.textContent = btnText;
  btn.onclick = () => { closeConfirm(); onConfirm(); };
  document.getElementById('confirmOverlay').classList.add('active');
}
function closeConfirm() {
  document.getElementById('confirmOverlay').classList.remove('active');
}

// ═══════════════════════════════════════════
// RENDER STUDENTS LIST
// ═══════════════════════════════════════════
function renderStudents() {
  const query = document.getElementById('searchInput').value.toLowerCase().trim();
  let filtered = db;
  if (query) {
    filtered = db.filter(s => {
      const haystack = [s.nombre, s.telefono, s.correo, s.direccion, s.sexo, s.tematica, s.sabe, s.nosabe, s.necesidades, s.personalidad, s.sugerencias, s.notas, s.aconsejable, s.pago, s.fechaUltimaClase || '', s.duracion || ''].join(' ').toLowerCase();
      return haystack.includes(query);
    });
  }

  const wrapper = document.getElementById('studentsTableWrapper');
  if (filtered.length === 0) {
    wrapper.innerHTML = `<div class="empty-state">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
      <h3>${query ? 'Sin resultados' : 'No hay alumnos registrados'}</h3>
      <p>${query ? 'Prueba con otro término de búsqueda.' : 'Añade tu primer alumno para empezar.'}</p>
      ${!query ? '<button class="btn btn-primary" onclick="switchView(\'add\')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg> Añadir Alumno</button>' : ''}
    </div>`;
    return;
  }

  let html = '<table class="students-table"><thead><tr><th>Alumno</th><th>Contacto</th><th>Última clase</th><th>Duración</th><th>Pago</th><th>Seguir</th><th style="text-align:right">Acciones</th></tr></thead><tbody>';
  filtered.forEach(s => {
    const initials = s.nombre.split(' ').map(w => w[0]).join('').substring(0, 2).toUpperCase();
    const payBadge = s.pago === 'Sí' ? 'badge-success' : s.pago === 'No' ? 'badge-danger' : s.pago === 'Se lo hago gratis' ? 'badge-info' : s.pago === 'A veces' ? 'badge-warning' : 'badge-info';
    const advBadge = s.aconsejable === 'Sí' ? 'badge-success' : s.aconsejable === 'No' ? 'badge-danger' : s.aconsejable === 'En evaluación' ? 'badge-warning' : 'badge-info';
    const fechaClase = s.fechaUltimaClase ? new Date(s.fechaUltimaClase + 'T00:00:00').toLocaleDateString('es-ES') : '—';
    html += `<tr class="fade-up">
      <td><div style="display:flex;align-items:center;gap:10px;">
        <div style="width:36px;height:36px;border-radius:50%;background:var(--brand);color:#fff;display:flex;align-items:center;justify-content:center;font-size:.72rem;font-weight:700;flex-shrink:0;">${initials}</div>
        <div><div class="student-name">${esc(s.nombre)}</div>
        <div class="student-email">${s.edad ? s.edad + ' años' : ''}${s.edad && s.sexo ? ' · ' : ''}${esc(s.sexo || '')}</div></div>
      </div></td>
      <td><div style="font-size:.82rem;">${esc(s.telefono || '—')}</div><div class="student-email">${esc(s.correo || '—')}</div></td>
      <td><span style="font-size:.82rem;">${esc(fechaClase)}</span></td>
      <td><span style="font-size:.82rem;">${esc(s.duracion || '—')}</span></td>
      <td><span class="badge ${payBadge}">${esc(s.pago || '—')}</span></td>
      <td><span class="badge ${advBadge}">${esc(s.aconsejable || '—')}</span></td>
      <td style="text-align:right;white-space:nowrap;">
        <button class="btn btn-ghost btn-sm" onclick="viewProfile('${s.id}')" title="Ver ficha"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg></button>
        <button class="btn btn-ghost btn-sm" onclick="editStudent('${s.id}')" title="Editar"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg></button>
        <button class="btn btn-ghost btn-sm" onclick="confirmDelete('${s.id}')" title="Eliminar" style="color:var(--danger);"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><path d="M3 6h18"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg></button>
      </td></tr>`;
  });
  html += '</tbody></table>';
  wrapper.innerHTML = html;
}

function esc(str) {
  const d = document.createElement('div');
  d.textContent = str || '';
  return d.innerHTML;
}

// ═══════════════════════════════════════════
// FORM: SAVE STUDENT (con auto-push)
// ═══════════════════════════════════════════
async function saveStudent(e) {
  e.preventDefault();
  const editId = document.getElementById('editId').value;
  const fechaUltimaClase = document.getElementById('f_fechaUltimaClase').value;
  const duracionUltimaClase = document.getElementById('f_duracion').value;

  let historialClases = [];
  if (editId) {
    const existing = db.find(s => s.id === editId);
    if (existing) historialClases = existing.historialClases || [];
  }
  if (fechaUltimaClase && duracionUltimaClase) {
    const existingIdx = historialClases.findIndex(h => h.fecha === fechaUltimaClase);
    if (existingIdx !== -1) { historialClases[existingIdx].duracion = duracionUltimaClase; }
    else { historialClases.push({ fecha: fechaUltimaClase, duracion: duracionUltimaClase }); }
    historialClases.sort((a, b) => b.fecha.localeCompare(a.fecha));
  }

  const student = {
    id: editId || generateId(),
    nombre: document.getElementById('f_nombre').value.trim(),
    telefono: document.getElementById('f_telefono').value.trim(),
    correo: document.getElementById('f_correo').value.trim(),
    direccion: document.getElementById('f_direccion').value.trim(),
    sexo: document.getElementById('f_sexo').value,
    edad: document.getElementById('f_edad').value ? parseInt(document.getElementById('f_edad').value) : null,
    fechaUltimaClase,
    duracion: duracionUltimaClase,
    historialClases,
    tematica: document.getElementById('f_tematica').value.trim(),
    sabe: document.getElementById('f_sabe').value.trim(),
    nosabe: document.getElementById('f_nosabe').value.trim(),
    necesidades: document.getElementById('f_necesidades').value.trim(),
    personalidad: document.getElementById('f_personalidad').value.trim(),
    sugerencias: document.getElementById('f_sugerencias').value.trim(),
    aconsejable: document.getElementById('f_aconsejable').value,
    pago: document.getElementById('f_pago').value,
    notas: document.getElementById('f_notas').value.trim(),
    fechaRegistro: editId ? (db.find(s => s.id === editId)?.fechaRegistro || new Date().toISOString()) : new Date().toISOString(),
    ultimaActualizacion: new Date().toISOString()
  };

  if (editId) {
    const idx = db.findIndex(s => s.id === editId);
    if (idx !== -1) db[idx] = student;
    notify('Alumno actualizado. Guardando en GitHub...');
  } else {
    db.push(student);
    notify('Alumno añadido. Guardando en GitHub...');
  }

  saveDB();
  resetForm();
  switchView('students');
  await pushToGitHub();
}

function resetForm() {
  document.getElementById('studentForm').reset();
  document.getElementById('editId').value = '';
  document.getElementById('formTitle').textContent = 'Nuevo Alumno';
}
function cancelForm() { resetForm(); switchView('students'); }

// ═══════════════════════════════════════════
// EDIT STUDENT
// ═══════════════════════════════════════════
function editStudent(id) {
  const s = db.find(st => st.id === id);
  if (!s) return;
  document.getElementById('editId').value = s.id;
  document.getElementById('f_nombre').value = s.nombre || '';
  document.getElementById('f_telefono').value = s.telefono || '';
  document.getElementById('f_correo').value = s.correo || '';
  document.getElementById('f_direccion').value = s.direccion || '';
  document.getElementById('f_sexo').value = s.sexo || '';
  document.getElementById('f_edad').value = s.edad || '';
  document.getElementById('f_fechaUltimaClase').value = s.fechaUltimaClase || '';
  document.getElementById('f_duracion').value = s.duracion || '';
  document.getElementById('f_tematica').value = s.tematica || '';
  document.getElementById('f_sabe').value = s.sabe || '';
  document.getElementById('f_nosabe').value = s.nosabe || '';
  document.getElementById('f_necesidades').value = s.necesidades || '';
  document.getElementById('f_personalidad').value = s.personalidad || '';
  document.getElementById('f_sugerencias').value = s.sugerencias || '';
  document.getElementById('f_aconsejable').value = s.aconsejable || '';
  document.getElementById('f_pago').value = s.pago || '';
  document.getElementById('f_notas').value = s.notas || '';
  document.getElementById('formTitle').textContent = 'Editar Alumno';
  document.getElementById('formSubmitBtn').innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg> Actualizar Alumno';
  switchView('add');
}

// ═══════════════════════════════════════════
// DELETE STUDENT (con auto-push)
// ═══════════════════════════════════════════
function confirmDelete(id) {
  const s = db.find(st => st.id === id);
  if (!s) return;
  showConfirm(
    '¿Eliminar alumno?',
    `Se eliminarán todos los datos de "${s.nombre}". Esta acción no se puede deshacer.`,
    async () => {
      db = db.filter(st => st.id !== id);
      saveDB();
      renderStudents();
      notify('Alumno eliminado. Guardando en GitHub...');
      await pushToGitHub();
    }
  );
}

// ═══════════════════════════════════════════
// VIEW PROFILE
// ═══════════════════════════════════════════
function viewProfile(id) {
  const s = db.find(st => st.id === id);
  if (!s) return;
  const initials = s.nombre.split(' ').map(w => w[0]).join('').substring(0, 2).toUpperCase();
  const regDate = s.fechaRegistro ? new Date(s.fechaRegistro).toLocaleDateString('es-ES') : '—';
  const updDate = s.ultimaActualizacion ? new Date(s.ultimaActualizacion).toLocaleDateString('es-ES') : '—';
  const payBadge = s.pago === 'Sí' ? 'badge-success' : s.pago === 'No' ? 'badge-danger' : s.pago === 'Se lo hago gratis' ? 'badge-info' : 'badge-warning';
  const advBadge = s.aconsejable === 'Sí' ? 'badge-success' : s.aconsejable === 'No' ? 'badge-danger' : 'badge-warning';

  const historial = s.historialClases || [];
  let historialHtml = '';
  if (historial.length > 0) {
    historialHtml = `<div class="profile-section"><h4>Historial de Clases (${historial.length} sesiones)</h4>
      <table class="history-table"><thead><tr><th>Fecha</th><th>Duración</th></tr></thead><tbody>
        ${historial.map(h => `<tr><td>${new Date(h.fecha + 'T00:00:00').toLocaleDateString('es-ES')}</td><td>${esc(h.duracion)}</td></tr>`).join('')}
      </tbody></table></div>`;
  }

  document.getElementById('profileContent').innerHTML = `
    <div class="card"><div class="card-body">
      <div class="profile-header">
        <div class="profile-avatar">${initials}</div>
        <div class="profile-info">
          <h2>${esc(s.nombre)}</h2>
          <div class="profile-meta">
            ${s.edad ? `<span>${s.edad} años</span>` : ''}
            ${s.sexo ? `<span>${esc(s.sexo)}</span>` : ''}
            <span>Registro: ${regDate}</span>
            <span>Actualizado: ${updDate}</span>
          </div>
        </div>
        <div style="margin-left:auto;display:flex;gap:8px;">
          <button class="btn btn-secondary btn-sm" onclick="editStudent('${s.id}')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>Editar
          </button>
          <button class="btn btn-secondary btn-sm" onclick="window.print()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></svg>Imprimir
          </button>
        </div>
      </div>
      <div class="profile-grid">
        <div>
          <div class="profile-section"><h4>Datos de Contacto</h4>
            <p><strong>Teléfono:</strong> ${esc(s.telefono || '—')}</p>
            <p><strong>Correo:</strong> ${esc(s.correo || '—')}</p>
            <p><strong>Dirección:</strong> ${esc(s.direccion || '—')}</p>
          </div>
          <div class="profile-section"><h4>Clases</h4>
            <p><strong>Fecha última clase:</strong> ${s.fechaUltimaClase ? new Date(s.fechaUltimaClase + 'T00:00:00').toLocaleDateString('es-ES') : '—'}</p>
            <p><strong>Duración última clase:</strong> ${esc(s.duracion || '—')}</p>
            <p><strong>Temática:</strong> ${esc(s.tematica || '—')}</p>
          </div>
          ${historialHtml}
          <div class="profile-section"><h4>Estado</h4>
            <p><strong>¿Paga bien?:</strong> <span class="badge ${payBadge}">${esc(s.pago || '—')}</span></p>
            <p style="margin-top:6px;"><strong>¿Recomendable seguir?:</strong> <span class="badge ${advBadge}">${esc(s.aconsejable || '—')}</span></p>
          </div>
        </div>
        <div>
          <div class="profile-section"><h4>Lo que sabe hacer</h4><p>${esc(s.sabe || '—')}</p></div>
          <div class="profile-section"><h4>Lo que no sabe hacer</h4><p>${esc(s.nosabe || '—')}</p></div>
          <div class="profile-section"><h4>Necesidades especiales</h4><p>${esc(s.necesidades || '—')}</p></div>
          <div class="profile-section"><h4>Personalidad</h4><p>${esc(s.personalidad || '—')}</p></div>
          <div class="profile-section"><h4>Sugerencias</h4><p>${esc(s.sugerencias || '—')}</p></div>
        </div>
      </div>
      ${s.notas ? `<div class="profile-section"><h4>Notas Adicionales</h4><p>${esc(s.notas)}</p></div>` : ''}
    </div></div>`;
  document.getElementById('viewTitle').textContent = s.nombre;
  switchView('profile');
}

// ═══════════════════════════════════════════
// EXPORT TO EXCEL (backup local)
// ═══════════════════════════════════════════
function exportToExcel() {
  if (db.length === 0) { notify('No hay datos para exportar', 'error'); return; }
  const rows = db.map(s => ({
    'Nombre completo': s.nombre || '',
    'Teléfono': s.telefono || '',
    'Correo electrónico': s.correo || '',
    'Dirección': s.direccion || '',
    'Sexo': s.sexo || '',
    'Edad': s.edad || '',
    'Fecha última clase': s.fechaUltimaClase ? new Date(s.fechaUltimaClase + 'T00:00:00').toLocaleDateString('es-ES') : '',
    'Duración última clase': s.duracion || '',
    'Nº clases': (s.historialClases || []).length,
    'Temática tratada': s.tematica || '',
    'Lo que sabe hacer': s.sabe || '',
    'Lo que no sabe hacer': s.nosabe || '',
    'Necesidades especiales': s.necesidades || '',
    'Personalidad': s.personalidad || '',
    'Sugerencias': s.sugerencias || '',
    '¿Recomendable seguir?': s.aconsejable || '',
    '¿Paga bien?': s.pago || '',
    'Notas adicionales': s.notas || '',
    'Fecha de registro': s.fechaRegistro ? new Date(s.fechaRegistro).toLocaleDateString('es-ES') : '',
    'Última actualización': s.ultimaActualizacion ? new Date(s.ultimaActualizacion).toLocaleDateString('es-ES') : ''
  }));
  const ws = XLSX.utils.json_to_sheet(rows);
  ws['!cols'] = [{wch:25},{wch:14},{wch:28},{wch:30},{wch:10},{wch:6},{wch:18},{wch:18},{wch:10},{wch:30},{wch:30},{wch:30},{wch:25},{wch:25},{wch:30},{wch:18},{wch:18},{wch:30},{wch:16},{wch:16}];
  const headerStyle = { font: { bold: true, color: { rgb: 'FFFFFF' } }, fill: { fgColor: { rgb: '2E8BC0' } }, alignment: { horizontal: 'center', vertical: 'center' } };
  const range = XLSX.utils.decode_range(ws['!ref']);
  for (let C = range.s.c; C <= range.e.c; C++) {
    const addr = XLSX.utils.encode_cell({ r: 0, c: C });
    if (ws[addr]) ws[addr].s = headerStyle;
  }
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, 'Alumnos');
  XLSX.writeFile(wb, `jam_alumnos_${new Date().toISOString().split('T')[0]}.xlsx`);
  notify('Excel exportado correctamente', 'success');
  closeSidebar();
}

// ═══════════════════════════════════════════
// STATISTICS
// ═══════════════════════════════════════════
function renderStats() {
  Object.values(chartInstances).forEach(c => c.destroy());
  chartInstances = {};
  if (db.length === 0) {
    document.getElementById('statsContent').innerHTML = `<div class="empty-state"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg><h3>Sin datos estadísticos</h3><p>Añade alumnos para ver las estadísticas.</p></div>`;
    return;
  }
  const total = db.length;
  const ages = db.filter(s => s.edad).map(s => s.edad);
  const avgAge = ages.length ? (ages.reduce((a,b) => a+b, 0) / ages.length).toFixed(1) : '—';
  const genderCount = {};
  db.forEach(s => { if(s.sexo) genderCount[s.sexo] = (genderCount[s.sexo]||0)+1; });
  let totalSessions = 0;
  const monthCount = {};
  db.forEach(s => {
    const hist = s.historialClases || [];
    totalSessions += hist.length;
    hist.forEach(h => { if (h.fecha) { const ym = h.fecha.substring(0, 7); monthCount[ym] = (monthCount[ym] || 0) + 1; } });
  });
  const durCount = {};
  db.forEach(s => { if(s.duracion) durCount[s.duracion] = (durCount[s.duracion]||0)+1; });
  const payCount = {};
  db.forEach(s => { if(s.pago) payCount[s.pago] = (payCount[s.pago]||0)+1; });
  const advCount = {};
  db.forEach(s => { if(s.aconsejable) advCount[s.aconsejable] = (advCount[s.aconsejable]||0)+1; });
  const ageRanges = {'0-12':0,'13-17':0,'18-30':0,'31-50':0,'51-65':0,'65+':0};
  ages.forEach(a => {
    if(a<=12) ageRanges['0-12']++;
    else if(a<=17) ageRanges['13-17']++;
    else if(a<=30) ageRanges['18-30']++;
    else if(a<=50) ageRanges['31-50']++;
    else if(a<=65) ageRanges['51-65']++;
    else ageRanges['65+']++;
  });
  const topicMap = {};
  db.forEach(s => {
    if (!s.tematica) return;
    s.tematica.split(/[,;\/\n]+/).forEach(t => { const clean = t.trim().toLowerCase(); if (clean) topicMap[clean] = (topicMap[clean]||0) + 1; });
  });
  const topTopics = Object.entries(topicMap).sort((a,b) => b[1]-a[1]).slice(0, 10);
  const payingCount = db.filter(s => s.pago === 'Sí').length;

  document.getElementById('statsContent').innerHTML = `
    <div class="stats-grid fade-up">
      <div class="stat-card"><div class="stat-label">Total Alumnos</div><div class="stat-value">${total}</div></div>
      <div class="stat-card"><div class="stat-label">Edad Media</div><div class="stat-value">${avgAge}</div><div class="stat-sub">${ages.length} con edad registrada</div></div>
      <div class="stat-card"><div class="stat-label">Pagan Bien</div><div class="stat-value">${payingCount}</div><div class="stat-sub">${total ? Math.round(payingCount/total*100) : 0}% del total</div></div>
      <div class="stat-card"><div class="stat-label">Temáticas</div><div class="stat-value">${Object.keys(topicMap).length}</div><div class="stat-sub">diferentes temas</div></div>
    </div>
    <div class="charts-grid fade-up">
      <div class="chart-card"><h4>Distribución por Sexo</h4><div class="chart-container"><canvas id="chartGender"></canvas></div></div>
      <div class="chart-card"><h4>Distribución por Edad</h4><div class="chart-container"><canvas id="chartAge"></canvas></div></div>
      <div class="chart-card"><h4>Clases por Mes</h4><div class="chart-container"><canvas id="chartMonths"></canvas></div></div>
      <div class="chart-card"><h4>Duración de Clase</h4><div class="chart-container"><canvas id="chartDuration"></canvas></div></div>
      <div class="chart-card"><h4>¿Paga Bien?</h4><div class="chart-container"><canvas id="chartPayment"></canvas></div></div>
      <div class="chart-card"><h4>¿Recomendable Seguir?</h4><div class="chart-container"><canvas id="chartAdvisable"></canvas></div></div>
    </div>
    ${topTopics.length > 0 ? `<div class="chart-card fade-up" style="margin-top:20px;"><h4>Temáticas Más Frecuentes</h4><ul class="topic-list">${topTopics.map(([t,c]) => `<li class="topic-item"><span>${t.charAt(0).toUpperCase()+t.slice(1)}</span><span class="topic-count">${c}</span></li>`).join('')}</ul></div>` : ''}`;

  const brandColors = ['#2E8BC0','#1B6A9C','#5CAED6','#A8D8EA','#0D4F6E','#3DA1D2'];
  const statusColors = { 'Sí':'#2a9d6a','No':'#d94452','A veces':'#e8a820','En evaluación':'#e8a820','Se lo hago gratis':'#2E8BC0' };

  if (Object.keys(genderCount).length) chartInstances.gender = new Chart(document.getElementById('chartGender'), { type:'doughnut', data:{labels:Object.keys(genderCount),datasets:[{data:Object.values(genderCount),backgroundColor:brandColors}]}, options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'bottom',labels:{font:{family:'DM Sans'}}}}} });
  if (ages.length) chartInstances.age = new Chart(document.getElementById('chartAge'), { type:'bar', data:{labels:Object.keys(ageRanges),datasets:[{label:'Alumnos',data:Object.values(ageRanges),backgroundColor:'#2E8BC0',borderRadius:6}]}, options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{y:{beginAtZero:true,ticks:{stepSize:1}},x:{ticks:{font:{family:'DM Sans'}}}}} });
  const sortedMonths = Object.keys(monthCount).sort();
  if (sortedMonths.length) chartInstances.months = new Chart(document.getElementById('chartMonths'), { type:'bar', data:{labels:sortedMonths.map(m => { const [y,mo]=m.split('-'); return ['Ene','Feb','Mar','Abr','May','Jun','Jul','Ago','Sep','Oct','Nov','Dic'][parseInt(mo)-1]+' '+y; }),datasets:[{label:'Clases',data:sortedMonths.map(m=>monthCount[m]),backgroundColor:'#5CAED6',borderRadius:6}]}, options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{y:{beginAtZero:true,ticks:{stepSize:1}},x:{ticks:{font:{family:'DM Sans'}}}}} });
  if (Object.keys(durCount).length) chartInstances.duration = new Chart(document.getElementById('chartDuration'), { type:'doughnut', data:{labels:Object.keys(durCount),datasets:[{data:Object.values(durCount),backgroundColor:brandColors}]}, options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'bottom',labels:{font:{family:'DM Sans'}}}}} });
  if (Object.keys(payCount).length) chartInstances.payment = new Chart(document.getElementById('chartPayment'), { type:'doughnut', data:{labels:Object.keys(payCount),datasets:[{data:Object.values(payCount),backgroundColor:Object.keys(payCount).map(k=>statusColors[k]||'#999')}]}, options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'bottom',labels:{font:{family:'DM Sans'}}}}} });
  if (Object.keys(advCount).length) chartInstances.advisable = new Chart(document.getElementById('chartAdvisable'), { type:'doughnut', data:{labels:Object.keys(advCount),datasets:[{data:Object.values(advCount),backgroundColor:Object.keys(advCount).map(k=>statusColors[k]||'#999')}]}, options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'bottom',labels:{font:{family:'DM Sans'}}}}} });
}

// ═══════════════════════════════════════════
// INIT — carga automática al arrancar
// ═══════════════════════════════════════════
const LOGO_SRC = "data:image/png;base64,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";

document.getElementById('logoImg').src = LOGO_SRC;
document.getElementById('printLogo').src = LOGO_SRC;

// Arranque: cargar datos locales primero, luego sincronizar con GitHub
loadDB();
renderStudents();

// Auto-pull al iniciar si GitHub está configurado
(async () => {
  if (isGitHubConfigured()) {
    setSyncStatus('syncing', 'Cargando datos...');
    await pullFromGitHub(true);
  } else {
    setSyncStatus('offline', 'Sin configurar');
  }
})();
</script>
</body>
</html>
